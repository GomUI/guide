<!DOCTYPE HTML>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1280, user-scalable=yes"><!--PC 최소 PXF로 고정하기! 프로젝트에 따라 변경 가능성-->
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#ffffff">
  <meta name="Description" content="사이트 설명">
  <link rel="shortcut icon" href="http://img.gomtv.com/gomtv_favicon_20140514.ico" type="image/x-icon">
  <title>GULP | UI Guide</title> <!-- [페이지명 | 사이트명] -->
  <script src="//www.gomlab.com/gomlab_v2/ui/js/jquery-1.12.4.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <script type="text/javascript" src="/ui_js/ui.js"></script>

</head>
<body id="body">
<ul class="quick">
  <li><a href="#body">Top</a></li>
  <li><a href="#footer">Down</a></li>
  <!--<li><a href="/html/index.html">index</a></li>-->
  <li><a href="/guide/html/index.html">index</a></li> <!--github 업데이트용 -->
</ul>
<header>
  <h1 class="logo">logo</h1>
  <p class="sub_tit"><strong>- Gulp 세팅 -</strong></p>
</header>
<nav>
  <ul>
    <li><a href="#new">신규 프로젝트 세팅</a></li>
    <li><a href="#old">기존 프로젝트 세팅</a></li>
    <li><a href="#gulp">Gulp Guide</a></li>
  </ul>
</nav>
<section class="container">
  <article id="new" class="cont">
    <h2>🥤 신규 프로젝트 세팅</h2>
    <h3>01. Node.js 설치</h3>
    <a href="https://nodejs.org/ko/" target="_blank">https://nodejs.org/ko/</a> 설치 후 npm -v 으로 버전 확인
    <p>현재 사용 버전 : v10.15.1</p>
    <h3>02. gitlab</h3>
    <ul class="list num">
      <li>1) <a href="https://gitlab.gomtv.com/ui/ui_template" target="_blank">https://gitlab.gomtv.com/ui/ui_template</a>에서 fork떠 신규 프로젝트 생성</li>
      <li>2) fork뜬 프로젝트의 setting 페이지에서 General project settings에서 프로젝트 이름과 설명을 변경</li>
      <li>3) Advanced settings에서 Remove fork relationship를 눌러서 fork 연결을 해지 한다.</li>
      <li>4) 새로 생성한 프로젝트 로컬에 clone <p class="desc"> 방법은 <a href="#">gitlab 가이드</a> 참고</p></li>
      <li>5) 필요없는 폴더 및 파일은 모두 지우고, gulpfile.js 및 기타 파일을 해당 프로젝트에 맞게 작업 환경 세팅</li>
      <li>
        6) terminal 에서 <span class="gom">npm install</span> 입력
        <p class="desc"> ackage.json에 이미 세팅을 해서, 필요한 모듈만 설치해 준다.</p>
        <p class="desc"> <del>gulp는 3.9.1 설치해야 한다. 4이상을 설치시 바벨 때문에 오류 남. 추후에 개발환경을 변경 할 수 있음</del></p>
        <p class="desc"> 2020년 gulp 버전을 4.0.2로 업데이트. 기존 프로젝트들도 모두 4.0.2로 업데이트 하였음</p>
      </li>
      <li>6) terminal 에서 <span class="gom">gulp</span> 입력<p class="desc">gulp 실행</p></li>
      <li>4) readme.md에 새로운 프로젝트 가이드 작성</li>
    </ul>
  </article>
  <article id="old" class="cont">
    <h2>🥤 기존 프로젝트 세팅</h2>
    <ul class="list num">
      <li>1) <a href="https://gitlab.gomtv.com/dashboard/groups" target="_blank">https://gitlab.gomtv.com/dashboard/groups</a>에서 원하는 프로젝트 선택</li>
      <li>2) 프로젝트를 로컬에 clone <p class="desc"> 방법은 <a href="#">gitlab 가이드</a> 참고</p></li>
      <li>3) terminal 에서 <span class="gom">npm install</span> 입력<br><span class="desc">package.json에 이미 세팅을 해서, 필요한 모듈만 설치해 준다.</span></li>
      <li>4) terminal 에서 <span class="gom">gulp</span> 입력<br><span class="desc">gulp 실행</span></li>
      <li>5) readme.md에 가이드 및 모듈 페이지 확인 후 작업</li>
    </ul>
  </article>
  <article id="gulp" class="cont">
    <h2>🥤 Gulp Guide</h2>
    <h3>1. gulp 사용 이유</h3>
    <ul class="list">
      <li>- 퍼블리싱 작업중에서 일일히 수작업으로 하기에 귀찮은 작업들이 너무 많다.</li>
      <li>- 압축하거나 html 코드 include, scss, 브라우저 리로딩 등등..</li>
      <li>- 이런 모든 귀찮은 작업을 gulp.js 를 이용하면 자동으로 해준다는 사실!</li>
      <li>- gulp는 편리한 전처리 도구이다. 무엇보다 문법이 쉬어서 빠르게 습득할 수 있는 장점이 있다.</li>
    </ul>
    <h3>2. gulp 설치</h3>
    <ul class="list num">
      <li>1) gulp를 사용하려면 반드시 node.js 설치해야 한다. node.js 사이트에 접속해서 다운받고 설치 한다.</li>
      <li>
        2) gulp 를 전역에 설치하기
        <p class="desc">
          package.json 참고 : <a href="https://elegantcoder.com/beginning-npm-package/" target="_blank">https://elegantcoder.com/beginning-npm-package/</a>
        </p>
        <pre class="code">
# gulp를 전역에 설치하기
$ npm install -g gulp
# 프로젝트 폴더에 package.json 만들기
$ npm init
</pre>
      </li>
    </ul>
    <h3>3. 디렉토리 구조</h3>
    <pre class="code">
project_name
    ├── dist
            ├── css
            ├── img
            ├── html
            └── js
    ├── node_modules
    ├── src
        ├── scss
            └── style.scss
        ├── img
         	├── image.png
         	├── sprite
            └── sprite_image.png
        ├── html
            ├── index.html
            └── include
                └── head.html
        └── js
            └── ui.js
    ├── gulpfile.js
    └── package.json
</pre>
    <h3>4. gulpfile.js 정의</h3>
    <ul class="list">
      <li>- gulpfile.js에서 gulp 플러그인 활용을 정의한다.</li>
      <li>- 아래 모듈 외에 추가를 원하는 모듈은 설치 후 package.json에 추가하면 된다.</li>
      <li>- gulp spritesmith를 사용하면 스프라이트 이미지와 css를 자동으로 생성해준다.<br>설정은  sprite.css.handlebars로 할수있다.<br>
        <span class="desc">추가할때마다 달라져서 현재는 잘 사용안함</span>
      </li>
      <li>📌 <a href="https://gulpjs.com/" target="_blank">gulp plugin은 이 사이트에서 확인 가능</a></li>
    </ul>
    <pre class="code">
<strong class="blue">gulpfile.js [버전 4.0.2]</strong>
<span class="blue">const</span> gulp = require('gulp');
<span class="blue">const</span> browsersync = require('browser-sync').create();
<span class="blue">const</span> html = require('gulp-html-tag-include');
<span class="blue">const</span> sass = require('gulp-sass');
<span class="blue">const</span> autoprefixer = require('gulp-autoprefixer');
<span class="blue">const</span> sourcemaps = require('gulp-sourcemaps');
<span class="blue">const</span> uglify = require('gulp-uglify');

<span class="blue">const</span> paths = {
  port: '9004', // 각 프로젝트 포트넘버
  input: './src/**/*',
  output: './dist/',
  html: {
    input: './src/**/*.html',
    output: './dist/'
  },
  style: {
    input: './src/scss/*.scss',
    output: './dist/css'
  },
  img: {
    input: './src/img/**/*',
    output: './dist/img/'
  },
  font: {
    input: './src/font/**/*',
    output: './dist/font'
  },
  js: {
    input: './src/ui_js/*.js',
    output: './dist/ui_js/'
  },
  file: {
    input: './src/file/**/*',
    output: './dist/file/'
  }
};

<span class="blue">function</span> browserSync(done) {
  console.log("start sync...");
  browsersync.init({
    port: paths.port,
    server: {
      baseDir: paths.html.output
    },
    startPath: './html/index.html' //index.html 일반 프로젝트에서는 index.html 로 변경
  });
  done();
}

<span class="blue">function</span> htmlComp() {
  return gulp.src(paths.html.input)
    .pipe(html())
    .pipe(gulp.dest(paths.html.output))
    .pipe(browsersync.reload({stream: true}));
}

<span class="blue">function</span> sassComp(done) {
  gulp.src(paths.style.input, {sourcemaps: true})
    .pipe(sass.sync().on('error', sass.logError))
    .pipe(sass({outputStyle: 'expanded'})) //nested, expanded, compact, compressed
    .pipe(sourcemaps.write())
    .pipe(gulp.dest(paths.style.output))
    .pipe(browsersync.reload({stream: true}));
  // 압축버전 - 이버전은 소스맵이 안맞아서 배포용으로 따로 뺌
  gulp.src(paths.style.input, {sourcemaps: true})
    .pipe(sass.sync().on('error', sass.logError))
    .pipe(autoprefixer())
    .pipe(sass({outputStyle: 'compressed'})) //nested, expanded, compact, compressed
    .pipe(gulp.dest(paths.style.output + '/min'));
  done();
}

<span class="blue">function</span> js() {
  return gulp.src(paths.js.input)
    .pipe(gulp.dest(paths.js.output))
    .pipe(uglify())
    .pipe(gulp.dest(paths.js.output + '/min'))
    .pipe(browsersync.reload({stream: true}));
}

<span class="blue">function</span> img() {
  return gulp.src(paths.img.input)
    .pipe(gulp.dest(paths.img.output))
    .pipe(browsersync.reload({stream: true}));
}

<span class="blue">function</span> font() {
  return gulp.src(paths.font.input)
    .pipe(gulp.dest(paths.font.output))
    .pipe(browsersync.reload({stream: true}));
}

<span class="blue">function</span> file() {
  return gulp.src(paths.file.input)
    .pipe(gulp.dest(paths.file.output))
    .pipe(browsersync.reload({stream: true}));
}

<span class="blue">function</span> watchFiles() {
  gulp.watch(paths.html.input, htmlComp);
  gulp.watch(paths.img.input, img);
  gulp.watch(paths.style.input, sassComp);
  gulp.watch(paths.js.input, js);
  gulp.watch(paths.font.input, font);
  gulp.watch(paths.file.input, file);

}

// export tasks
exports.default = gulp.series(gulp.parallel(htmlComp, sassComp, img, js, font, file), browserSync, watchFiles);
</pre>

    <pre class="code">
<strong class="blue">gulpfile.js [버전 3.9.1 히스토리]</strong>
<span class="blue">var</span> gulp = require('gulp'),
    browserSync = require('browser-sync').create(),
    html = require('gulp-html-tag-include'),
    sass = require('gulp-sass'),
    autoprefixer = require('gulp-autoprefixer'),
    sourcemaps = require('gulp-sourcemaps'),
    uglify = require('gulp-uglify');
    var gulp = require('gulp'),
    		sass = require('gulp-sass'),
    		autoprefixer = require('gulp-autoprefixer'),
    		sourecemaps = require('gulp-sourcemaps'),
    		browserSync = require('browser-sync'),
    		html = require('gulp-html-tag-include'),
    		spritesmith = require('gulp.spritesmith'),
    		watch = require('gulp-watch'),
    		concat = require('gulp-concat'),
    		babel = require('gulp-babel'),
    		uglify = require('gulp-uglify-es').default, // es6용
        gutil  = require('gulp-util'),
        rename = require('gulp-rename');

    /*=============================
     @Path 정의
     ==============================*/
    var paths = {
     	port:3000,
    	input: 'src/**/*',
    	output: 'dist/',
    	style: {
    		input: 'src/scss/*.scss',
    		output: 'dist/css/'
    	},
    	...
    };
    ...
    // browser-sync
    gulp.task('browserSync', function () {
        console.log("gulp 시작!!");
        browserSync.init({
            port:paths.port,            // port: 3000
            server:{
                baseDir: paths.html.output
            },
            startPath:'./html/index.html'
        })
    });
    gulp.task('watch', ['html-include','sass','js','img'], function() {
      gulp.watch(paths.style.input, ['sass']);
      gulp.watch(paths.html.input, ['html-include']);
      gulp.watch(paths.js.input, ['js']);
    });

    gulp.task('default',['browserSync','watch']);
</pre>

    <pre class="code">
  <strong class="blue">sprite.css.handlebars</strong>
  .spurl {
    	display:inline-block;
    	background-image: url($url +'sprite.png');
    	background-repeat:no-repeat;
    }
    {{#sprites}}
    	%{{name}} {
    		width: {{px.width}};
    		height: {{px.height}};
    		background-position:{{px.offset_x}} {{px.offset_y}};
    		content:"";
    		@extend .spurl;
    	}
    	.{{name}}{
    		width: {{px.width}};
    		height: {{px.height}};
    		background-position:{{px.offset_x}} {{px.offset_y}};
    		@extend .spurl;
    		@include blind_txt;
    		overflow: hidden;
    	}
    {{/sprites}}
</pre>
  </article>
</section>
<footer  id="footer"></footer>
</body>
</html>